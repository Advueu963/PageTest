
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>13. Credal Sets and Classifiers &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/myStyle.css?v=e90502a2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"N": ["\\mathbb{N}"], "vec": ["\\boldsymbol{#1}", 1], "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"], "defeq": ["\\mathrel{\\vcenter{\\baselineskip0.5ex \\lineskiplimit0pt \\hbox{\\footnotesize.}\\hbox{\\footnotesize.}}}% ="], "given": ["\\, | \\,"], "cX": ["\\mathcal{X}"], "cY": ["\\mathcal{Y}"], "cH": ["\\mathcal{H}"], "cD": ["\\mathcal{D}"], "hath": ["\\hat{h}"], "haty": ["\\hat{y}"], "hatp": ["\\hat{p}"], "sety": ["\\widehat{Y}"], "argmin": ["\\operatorname*{argmin}"], "argmax": ["\\operatorname*{argmax}"], "db": ["\\set{M}"], "fkt": ["#1(\\cdot)", 1], "chrfkt": ["\\mathbb{I}_{#1}", 1], "kref": ["(\\ref{#1})", 1], "convto": ["(\\rightarrow"], "fft": ["(#1 :  #2 \\rightarrow #3", 3], "with": ["\\,  | \\,"], "sothat": ["\\,  : \\,"], "defi": ["\\stackrel{\\on{df}}{=}"], "set": ["\\mathcal{#1}", 1], "Prob": ["P"], "prob": ["p"], "impl": ["\\Rightarrow"], "on": ["\\operatorname"], "groesser": ["\\raisebox{#1mm}{} \\raisebox{-#1mm}{}", 1], "sgroesser": ["\\groesser{1.20}"], "xleftr": ["\\left( \\groesser{1.35} "], "xleftg": ["\\left\\{ \\groesser{1.35} "], "fftm": ["\\fft{#1}{#2}{#3} \\, ,\\, #4 \\mapsto #5", 5], "gdw": ["\\Leftrightarrow"], "gdwbd": ["\\stackrel{\\on{df}}{\\Leftrightarrow}"], "est": ["{est}"], "epd": ["\\Leftrightarrow_{\\on{def}}"], "fromto": ["\\longrightarrow"], "pref": ["\\succ"], "evalue": ["\\mathbf{E}"], "variance": ["\\mathbf{V}"], "mmp": ["", 1], "llbracket": ["\\lbrack\\lbrack"], "rrbracket": ["\\rbrack\\rbrack"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter-credal_sets/credal_sets';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="14. Reliable Classification" href="../chapter-reliable_classification/reliable_classification.html" />
    <link rel="prev" title="12. Bayesian Neural Networks" href="../chapter-bayesian_neuralnetwork/bayesian.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../startPage.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../startPage.html">
                    Toolbox for Uncertainty Quantification in Machine Learning
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter-prelude/prelude.html">1. Prelude</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-intro/intro.html">2. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-srcUncertainty/src.html">3. Sources of uncertainty in supervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-modelingAproxUncertainty/modelingAproxUncertainty.html">4. Modelling Approximation Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-pe-scoring/scoring.html">5. Probability Estimation via Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-pe-calibration/calibration.html">6. Probability Estimation and Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-pe-ensemble/ensemble.html">7. Probability Estimation and Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-mle_and_fisher/mle.html">8. Maximum Likelihood and Fisher Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-generative_models/gm.html">9. Generative Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-gaussianprocess/gaussianprocess.html">10. Gaussian Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-deep_neuralnetwork/dnn.html">11. Deep Neural Network Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-bayesian_neuralnetwork/bayesian.html">12. Bayesian Neural Networks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">13. Credal Sets and Classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-reliable_classification/reliable_classification.html">14. Reliable Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-conformel_classification/conformel_classification.html">15. Conformal Prediction for Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-conformel_regression/conformel_regression.html">16. Conformal Prediction for Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-setValued_utilityMaximization/set.html">17. Set-valued Prediction Based on Utility Maximization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter-appendix/appendix.html">18. Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">19. References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/Advueu963/PageTest/blob/main/chapter-credal_sets/credal_sets.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Advueu963/PageTest" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Advueu963/PageTest/edit/main/chapter-credal_sets/credal_sets.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Advueu963/PageTest/issues/new?title=Issue%20on%20page%20%2Fchapter-credal_sets/credal_sets.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter-credal_sets/credal_sets.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Credal Sets and Classifiers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-credal-classifier">13.1. Naive Credal Classifier</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imprecise-dirichlet-model">13.1.1. Imprecise Dirichlet Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-measures-for-credal-sets">13.2. Uncertainty measures for credal sets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#credal-set-for-demonstration-of-uncertainty-measures">13.2.1. Credal set for demonstration of uncertainty measures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hartley-measure">13.2.2. Hartley Measure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalized-hartley-measure">13.2.3. Generalized Hartley Measure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upper-and-lower-shannon-entropy">13.2.4. Upper and Lower Shannon entropy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-decomposition">13.3. Uncertainty Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-valued-prediction">13.4. Set-valued prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dominance-degrees">13.4.1. Dominance degrees</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="credal-sets-and-classifiers">
<span id="credal"></span><h1><span class="section-number">13. </span>Credal Sets and Classifiers<a class="headerlink" href="#credal-sets-and-classifiers" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Patch</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="c1"># Vector Graphics</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib_inline</span>
<span class="n">matplotlib_inline</span><span class="o">.</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">combinations</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span><span class="p">,</span> <span class="n">CategoricalNB</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span><span class="p">,</span> <span class="n">load_wine</span>

<span class="kn">import</span> <span class="nn">mpltern</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">dirichlet</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># seed everything</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sk_rstate</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">sp_state</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</details>
</div>
<div align="justify">
<p>The theory of imprecise probabilities (<span id="id1">Walley [<a class="reference internal" href="../references.html#id939" title="P. Walley. Statistical Reasoning with Imprecise Probabilities. Chapman and Hall, 1991.">Wal91</a>]</span>) is largely built on the idea to specify
knowledge in terms of a set <span class="math notranslate nohighlight">\(Q\)</span> of probability distributions instead of a single distribution.
In the literature, such sets are also referred to as <em>credal sets</em>, and often assumed to be
convex (i.e.,<span class="math notranslate nohighlight">\(q , q' \in Q\)</span> implies <span class="math notranslate nohighlight">\(\alpha q + (1-\alpha) q' \in Q\)</span> for all <span class="math notranslate nohighlight">\(\alpha \in [0,1]\)</span>).
The concept of credal
sets and related notions provide the basis of a generalization of Bayesian inference, which
is especially motivated by the criticism of non-informative priors as models of ignorance
in standard Bayesian inference (cf. <a class="reference internal" href="../chapter-modelingAproxUncertainty/modelingAproxUncertainty.html"><span class="doc">Modelling Approximation Uncertainty</span></a>). The basic idea is to replace a single
prior distribution on the model space, as used in Bayesian inference, by a (credal) set of
candidate priors. Given a set of observed data, Bayesian inference can then be applied
to each candidate prior, thereby producing a (credal) set of posteriors. Correspondingly,
any value or quantity derived from a posterior (e.g., a prediction, an expected value,
etc.) is replaced by a set of such values or quantities. An important example of such
an approach is robust inference for categorical data with the imprecise Dirichlet model,
which is an extension of inference with the Dirichlet distribution as a conjugate prior for
the multinomial distribution (<span id="id2">Bernardo [<a class="reference internal" href="../references.html#id11" title="J.M. Bernardo. An introduction to the imprecise Dirichlet model for multinomial data. International Journal of Approximate Reasoning, 39(2–3):123–150, 2005.">Ber05</a>]</span>).</p>
</div><section id="naive-credal-classifier">
<h2><span class="section-number">13.1. </span>Naive Credal Classifier<a class="headerlink" href="#naive-credal-classifier" title="Link to this heading">#</a></h2>
<div align="justify">
<p>Methods of that kind have also been used in the context of machine learning, for example in the framework of the Naïve Credal Classifier (<span id="id3">Corani and Zaffalon [<a class="reference internal" href="../references.html#id233" title="G. Corani and M. Zaffalon. Learning reliable classifiers from small or incomplete data sets: The naive credal classifier 2. Journal of Machine Learning Research, 9:581–621, 2008.">CZ08a</a>], Zaffalon [<a class="reference internal" href="../references.html#id2265" title="Marco Zaffalon. The naive credal classifier. Journal of Statistical Planning and Inference, 105(1):5–21, 2002.">Zaf02b</a>]</span>) or more recently as an extension of sum-product networks (<span id="id4">Maau <em>et al.</em> [<a class="reference internal" href="../references.html#id10" title="D. Deratani Maau, F.G. Cozman, D. Conaty, and C. Polpo de Campos. Credal sum-product networks. In PMLR: Proceedings of Machine Learning Research (ISIPTA 2017), volume 62, 205-216. 2017.">MCCdC17</a>]</span>). As for the former, we can think of a Naïve Bayes (NB) classifier as a hypothesis <span class="math notranslate nohighlight">\(h = h_{\vec{\theta}}\)</span> specified by a parameter vector <span class="math notranslate nohighlight">\({\vec{\theta}}\)</span> that comprises a prior probability <span class="math notranslate nohighlight">\(\theta_k\)</span> for each class <span class="math notranslate nohighlight">\(y_k \in \set{Y}\)</span> and a conditional probability <span class="math notranslate nohighlight">\(\theta_{i,j,k}\)</span> for observing the <span class="math notranslate nohighlight">\(i^{th}\)</span> value <span class="math notranslate nohighlight">\(a_{i,j}\)</span> of the <span class="math notranslate nohighlight">\(j^{th}\)</span> attribute given class <span class="math notranslate nohighlight">\(y_k\)</span>. For a given query instance specified by attributes <span class="math notranslate nohighlight">\((a_{i_1,1}, \ldots , a_{i_J,J})\)</span>, the posterior class probabilities are then given by</p>
<div class="math notranslate nohighlight" id="equation-spo">
<span class="eqno">(13.1)<a class="headerlink" href="#equation-spo" title="Link to this equation">#</a></span>\[
p(y_k | a_{i_1,1}, \ldots , a_{i_J,J}) \propto \theta_k \prod_{j=1}^J \theta_{i_j,j,k} \,.
\enspace
\]</div>
</div><p>For illustration we use the wine dataset.  We discretize it to make it suitable for categorical naive bayes and also drop some attributes to introduce more uncertainty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load and discretize the Wine dataset</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">wine</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">columns</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">target</span>

<span class="n">target_names</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">target_names</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wine</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)[</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># discretize data </span>
<span class="n">discretizer</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">&#39;ordinal&#39;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">X_binned</span> <span class="o">=</span> <span class="n">discretizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># create df for visualization</span>
<span class="n">bin_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]</span>
<span class="n">X_binned_labeled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_binned</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bin_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
<span class="n">y_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
<span class="n">y_df</span><span class="p">[</span><span class="s1">&#39;target_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">target_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">wine_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_binned_labeled</span><span class="p">,</span> <span class="n">y_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># split into train and test data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_binned</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">sk_rstate</span><span class="p">)</span>

<span class="n">wine_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alcohol</th>
      <th>malic_acid</th>
      <th>ash</th>
      <th>alcalinity_of_ash</th>
      <th>target</th>
      <th>target_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>high</td>
      <td>low</td>
      <td>medium</td>
      <td>low</td>
      <td>0</td>
      <td>class_0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>medium</td>
      <td>low</td>
      <td>medium</td>
      <td>low</td>
      <td>0</td>
      <td>class_0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>medium</td>
      <td>low</td>
      <td>high</td>
      <td>medium</td>
      <td>0</td>
      <td>class_0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>high</td>
      <td>low</td>
      <td>medium</td>
      <td>low</td>
      <td>0</td>
      <td>class_0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>medium</td>
      <td>medium</td>
      <td>high</td>
      <td>medium</td>
      <td>0</td>
      <td>class_0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div align="justify">
<p>When we train a regular categorical Naive Bayes classifier the prior probabilities <span class="math notranslate nohighlight">\(\theta_k\)</span> for each class are calculated as the relative frequencies of class <span class="math notranslate nohighlight">\(k\)</span> in the whole dataset. The conditionals <span class="math notranslate nohighlight">\(\theta_{i,j,k}\)</span> as the share of observations for which attribute <span class="math notranslate nohighlight">\(j\)</span> has the value <span class="math notranslate nohighlight">\(i\)</span> given that the class is <span class="math notranslate nohighlight">\(k\)</span>.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># init categori1cal NB without laplace smoothing</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CategoricalNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

<span class="c1"># train NB</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># get prior probabilites from model</span>
<span class="n">model</span><span class="o">.</span><span class="n">class_prior</span>
<span class="n">prior_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">class_log_prior_</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prior probabilities:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">{</span><span class="n">c</span> <span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">target_names</span><span class="p">,</span> <span class="n">prior_probabilities</span><span class="p">)})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prior probabilities:
{&#39;class_0&#39;: 0.317, &#39;class_1&#39;: 0.401, &#39;class_2&#39;: 0.282}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get conditional probabilities from model</span>
<span class="n">conditionals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_log_prob_</span>

<span class="n">conditionals_alcohol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">conditionals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Conditional probabilities of feature 1 values given targets:&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="p">{</span><span class="n">v</span> <span class="p">:</span> <span class="n">conditionals_alcohol</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">])}</span>
 <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_names</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Conditional probabilities of feature 1 values given targets:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;class_0&#39;: {&#39;low&#39;: 0.021, &#39;medium&#39;: 0.396, &#39;high&#39;: 0.583},
 &#39;class_1&#39;: {&#39;low&#39;: 0.55, &#39;medium&#39;: 0.4, &#39;high&#39;: 0.05},
 &#39;class_2&#39;: {&#39;low&#39;: 0.093, &#39;medium&#39;: 0.651, &#39;high&#39;: 0.256}}
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>After that point predictions are made by computing the likelihood of a query as the product of the corresponding priors and conditionals:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">point_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point predictions for first ten queries: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">point_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Point predictions for first ten queries: 
 [[0.898 0.032 0.07 ]
 [0.205 0.048 0.747]
 [0.08  0.111 0.809]
 [0.828 0.064 0.109]
 [0.042 0.929 0.029]
 [0.828 0.064 0.109]
 [0.009 0.655 0.336]
 [0.057 0.159 0.784]
 [0.038 0.91  0.051]
 [0.057 0.159 0.784]]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>In the Naïve Credal Classifier, the <span class="math notranslate nohighlight">\(\theta_k\)</span> and <span class="math notranslate nohighlight">\(\theta_{i_j,j,k}\)</span> are specified in terms of (local) credal sets, i.e., there is a class of probability distributions <span class="math notranslate nohighlight">\(Q\)</span> on <span class="math notranslate nohighlight">\(\set{Y}\)</span> playing the role of candidate priors, and a class of probability distributions <span class="math notranslate nohighlight">\(Q_{j,k}\)</span> specifying possible distributions on the attribute values of the <span class="math notranslate nohighlight">\(j^{th}\)</span> attribute given class <span class="math notranslate nohighlight">\(y_k\)</span>. A single posterior class probability <a class="reference internal" href="#equation-spo">(13.1)</a> is then replaced by the set (interval) of such probabilities that can be produced by taking <span class="math notranslate nohighlight">\(\theta_k\)</span> from a distribution in <span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(\theta_{i_j,j,k}\)</span> from a distribution in <span class="math notranslate nohighlight">\(Q_{j,k}\)</span>. As an aside, let us note that the computations involved may of course become costly.</p>
</div><section id="imprecise-dirichlet-model">
<h3><span class="section-number">13.1.1. </span>Imprecise Dirichlet Model<a class="headerlink" href="#imprecise-dirichlet-model" title="Link to this heading">#</a></h3>
<div align="justify">
<p>To obtain the credal sets over priors and conditionals the imprecise dirchlet model can be used.(<span id="id5">Zaffalon [<a class="reference internal" href="../references.html#id1726" title="M. Zaffalon. The naive credal classifier. Journal of Statistical Planning and Inference, 105(1):5–21, 2002.">Zaf02a</a>]</span>) The key idea is to model uncertainty about the observations by drawing random samples around them from a dirichlet distribution. For this the concentration parameters <span class="math notranslate nohighlight">\(\alpha=(\alpha_{1},...,\alpha_{k})\)</span> of the dirichlet distribution are parametrized as <span class="math notranslate nohighlight">\(st\)</span>. The empirical priors and conditionals as used in the normal Naive Bayes are used as the parameter <span class="math notranslate nohighlight">\(t\)</span>:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">prior_probabilities</span>
<span class="n">prior_credal</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">sp_state</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Empirical prior:</span><span class="si">{</span><span class="n">prior_probabilities</span><span class="si">}</span><span class="se">\n</span><span class="s1">Prior credal_set:&#39;</span> <span class="p">)</span>
<span class="n">prior_credal</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Empirical prior:[0.317 0.401 0.282]
Prior credal_set:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.4462, 0.3532, 0.2006],
       [0.13  , 0.6009, 0.2691],
       [0.1724, 0.5359, 0.2917]])
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>The parameter <span class="math notranslate nohighlight">\(s &gt; 0\)</span> is a fixed constant that can be used to express the degree of believe into the observations. Choosing <span class="math notranslate nohighlight">\(s\)</span> to be high will cause the distribution to be more concentrated around <span class="math notranslate nohighlight">\(t\)</span>. Thus the distribution is less spread out and the uncertainty reduced.</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_ternary_plots</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;ternary&#39;</span><span class="p">})</span>
    <span class="n">s_vals</span><span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">dirichlet</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">sp_state</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">samples</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">samples</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s=</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;Credal sets generated by dirichlet model for different values of s.</span><span class="se">\n</span><span class="s1"> Each blue point corresponds to one distribution, the red point to the empirical distribution.&#39;</span><span class="p">,</span> 
                           <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">create_ternary_plots</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/cda77eb26650bd0e61ab31c74bdb87df35311aeddcbf46278e598da580a0ec79.svg" src="../_images/cda77eb26650bd0e61ab31c74bdb87df35311aeddcbf46278e598da580a0ec79.svg" />
</div>
</div>
<div align="justify">
<p>The Naive Credal Classifier produces set predictions as credal sets of posterior distributions. This is done by computing a posterior distribution for each combination of prior and conditional distributions out of the prior and conditional credal sets. While this is impractical we can approximate the true solution by computing the posterior for a fixed number of samples from the prior and posterior credal sets:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoricalNCC</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">CategoricalNB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">class_log_prior_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> 
                                        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">feature_log_prob_</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        
        <span class="c1">#s = self.data_size / 10</span>
        
        <span class="n">posterior_credal_sets</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sample_size</span><span class="p">):</span>
            
            <span class="c1"># sample priors</span>
            <span class="n">dirichlet_priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">class_frequencies</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">sp_state</span><span class="p">))</span>
            
            <span class="c1"># sample conditionals</span>
            <span class="n">dirichlet_conditionals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">])</span> 
                                               <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_frequencies</span><span class="p">]</span>
            
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
            <span class="n">model</span><span class="o">.</span><span class="n">class_log_prior_</span> <span class="o">=</span> <span class="n">dirichlet_priors</span>
            <span class="n">model</span><span class="o">.</span><span class="n">feature_log_prob_</span> <span class="o">=</span> <span class="n">dirichlet_conditionals</span>
            <span class="c1">#with warnings.catch_warnings():</span>
            <span class="c1">#    warnings.simplefilter(&quot;ignore&quot;)</span>
            <span class="c1">#    pred = model.predict_proba(X)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">posterior_credal_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
            
        <span class="n">posterior_credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">posterior_credal_sets</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">posterior_credal_sets</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>With this we can train the Naive Credal Classifier on the test data and obtain a posterior credal set for each query in the training data. So for each of the 36 entries in the test dataset we obtain a credal set of 1000 distributions. Each distribution in the credal represents probabilities for each class equivalently to the point predictions obtained earlier. Comparing some of the distributions in a queries credal set with the point prediction made for the same query shows that the probabilities are similar however the credal set contains some variation around the point prediction. This can be interpreted as the uncertainty contained in that model, which could then be analyzed with the methods discussed in <a class="reference internal" href="#uncertainty-measures"><span class="std std-ref">Uncertainty measures for credal sets</span></a>. It is also possible to produce uncertainty aware predictions using <a class="reference internal" href="#set-predictions"><span class="std std-ref">Set-valued prediction</span></a>.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train NCC model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CategoricalNCC</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

<span class="c1"># get prediction</span>
<span class="n">wine_credal_sets</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape: </span><span class="se">\n</span><span class="si">{</span><span class="n">wine_credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;First distributions of credal set for first query: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">wine_credal_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Naive Bayes prediction for first query: </span><span class="se">\n</span><span class="si">{</span><span class="n">point_predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: 
(36, 1000, 3)
First distributions of credal set for first query: 
 [[0.881 0.014 0.106]
 [0.922 0.051 0.026]
 [0.967 0.014 0.018]
 [0.628 0.057 0.315]
 [0.943 0.046 0.011]
 [0.944 0.011 0.045]
 [0.801 0.083 0.116]
 [0.863 0.074 0.063]
 [0.916 0.024 0.06 ]
 [0.818 0.136 0.046]]
Naive Bayes prediction for first query: 
[0.898 0.032 0.07 ]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>We can get a better understanding for the predictions of the Naive credal classifier by visualizing some of the posterior credal sets in a barycentric coordinate system. Each of the blue points represents one distribution within the posterior credal set, the red point the point prediction made by the basic Naive Bayes model. We can see how the Naive Credal Classifier models uncertainty about the point prediction by creating a credal set around it:</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_posterior_plot</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">,</span> <span class="n">point_predictions</span><span class="p">,</span> <span class="n">ridx</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">axtitles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;ternary&#39;</span><span class="p">})</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>

        <span class="n">credal_set</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">ridx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">point_predictions</span><span class="p">[</span><span class="n">ridx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">credal_set</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">credal_set</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">credal_set</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="c1">#ax.scatter(*credal_set[:,:], marker=&#39;.&#39;, s=10, alpha=0.5, color=&#39;blue&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">axtitles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> 
                           <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># visualize credal sets of 3 random queries</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Posterior credal sets for three random queries. Point prediction in red&quot;</span>
<span class="n">ridx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
<span class="n">create_posterior_plot</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">point_predictions</span><span class="p">,</span> <span class="n">ridx</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/0d89906fafdcfe060224374f30275154e0b19b84f959b6631c12b054bece2f46.svg" src="../_images/0d89906fafdcfe060224374f30275154e0b19b84f959b6631c12b054bece2f46.svg" />
</div>
</div>
</section>
</section>
<section id="uncertainty-measures-for-credal-sets">
<span id="uncertainty-measures"></span><h2><span class="section-number">13.2. </span>Uncertainty measures for credal sets<a class="headerlink" href="#uncertainty-measures-for-credal-sets" title="Link to this heading">#</a></h2>
<div align="justify">
<p>Interestingly, there has been quite some work on defining uncertainty measures for credal sets and related representation, such as Dempster-Shafer evidence theory (<span id="id6">Klir [<a class="reference internal" href="../references.html#id1394" title="G.J. Klir. Measures of uncertainty in the Dempster-Shafer theory of evidence. In R.R. Yager, M. Fedrizzi, and J. Kacprzyk, editors, Advances in the Dempster-Shafer theory of evidence, pages 35-49. Wiley, New York, 1994.">Kli94</a>]</span>). Even more interestingly, a basic distinction between two types of uncertainty contained in a credal set, referred to as <em>conflict</em> (randomness, discord) and <em>non-specificity</em>, respectively, has been made by (<span id="id7">Yager [<a class="reference internal" href="../references.html#id1519" title="R.R. Yager. Entropy and specificity in a mathematical theory of evidence. International Journal of General Systems, 9:249-260, 1983.">Yag83</a>]</span>). The importance of this distinction was already emphasized by (<span id="id8">Kolmogorov [<a class="reference internal" href="../references.html#id2267" title="A.N. Kolmogorov. Three approaches to the quantitative definition of information. Problems Inform. Trans., 1(1):1–7, 1965.">Kol65</a>]</span>). These notions are in direct correspondence with what we call aleatoric and epistemic uncertainty.</p>
</div><div align="justify">
<section id="credal-set-for-demonstration-of-uncertainty-measures">
<h3><span class="section-number">13.2.1. </span>Credal set for demonstration of uncertainty measures<a class="headerlink" href="#credal-set-for-demonstration-of-uncertainty-measures" title="Link to this heading">#</a></h3>
<p>For illustration of the uncertainty measures we will introduce a second dataset that consists of two features and three classes. To obtain credal sets for all queries in the test set we train three different Gaussian Naive Bayes Classifiers on random subsets of the training set and combine the probability predictions. The idea is to obtain three conflicting predictions from the classifiers. This allows us to distinguish between different kinds of uncertainty. Aleatoric uncertainty will be high in the areas in which the three clusters overlap while epistemic uncertainty will be high in areas where we have no data or in which the classifiers produce different predictions. The two dimensionality of the data set allows us to easily visualize conflicting predictions as well as uncertainty in different regions.</p>
<p>The new dataset consists of a gaussian cluster for each of the three classes:</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_std</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>

<span class="c1"># visualize dataset</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sample dataset with three classes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Feature 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Feature 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">legend1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="n">scatter</span><span class="o">.</span><span class="n">legend_elements</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Classes&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/52e181b6dd0b9c3dc8af520f7a75e1369269e32644308458a0c135e0abceec78.svg" src="../_images/52e181b6dd0b9c3dc8af520f7a75e1369269e32644308458a0c135e0abceec78.svg" />
</div>
</div>
<div align="justify">
<p>Next we train the different classifiers on them and combine their predictions to the credal set.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_posterior_credal_set</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">):</span>
    <span class="c1"># constructs posterior credal set out of classifier predictions</span>
    
    <span class="c1"># get posterior class probabilities</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> 
                     <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">]</span>
    
    <span class="c1"># combine posteriors into credal sets</span>
    <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">probabilities</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">credal_sets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># split into train and test data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># train three Naive bayes classifiers on subsets of training data</span>

<span class="n">classifiers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="mi">30</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">X_subset</span><span class="p">,</span> <span class="n">y_subset</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subset</span><span class="p">,</span> <span class="n">y_subset</span><span class="p">)</span>
    
    <span class="n">classifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">credal_sets</span> <span class="o">=</span> <span class="n">get_posterior_credal_set</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Credal set of first test data query:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Credal set of first test data query:
 [[0.882 0.005 0.113]
 [0.904 0.068 0.028]
 [0.746 0.002 0.252]]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>We can visualize the different predicitons by plotting the decision boundary for each classifier:</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_differnces_in_boundary_old</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>

	<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
	<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

	<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
	<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

	<span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">])</span>
	<span class="n">nvotes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pr</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
	
	<span class="c1"># Define a custom colormap</span>
	<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
	<span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

	<span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nvotes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

	<span class="c1"># Create a legend</span>
	<span class="n">legend_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
    <span class="p">}</span>
    
	<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    
	<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of differnt predictions&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_differnces_in_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
	<span class="n">number_of_classes</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># parameter used for the colors</span>
 
	<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
	<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

	<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
	<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

	<span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">])</span>
	<span class="n">nvotes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pr</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
	
    <span class="c1"># Build the Discrete Color Map</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s2">&quot;tab10&quot;</span><span class="p">]</span>  <span class="c1"># define the colormap</span>
 
    <span class="c1"># define the bins and normalize</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">)</span> <span class="c1"># second parameter indicates the c</span>

	<span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nvotes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

	<span class="c1"># Create a legend</span>
	<span class="n">legend_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
    <span class="p">}</span>
    
	<span class="c1"># Create legend patches</span>
	<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

	<span class="c1"># Add the legend with the patches</span>
	<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		
	<span class="c1">#ax.legend(handles=patches, loc=&#39;upper right&#39;)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of different predictions&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_decision_boundary</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
    
    <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="c1">#plt.contourf(x,y,labels,cmap=&#39;RdBu&#39;)</span>
    <span class="c1">#plt.show()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">plot_decision_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Classifier </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Decision boundaries of the three classifiers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14e948955332eba4174ad5e583647d99033f58a9e2e54bcf17960ca78b53fb85.svg" src="../_images/14e948955332eba4174ad5e583647d99033f58a9e2e54bcf17960ca78b53fb85.svg" />
</div>
</div>
<div align="justify">
<p>We can get a more compact visualization of their differences by plotting the number of different predictions for a point in the area instead:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plot_differnces_in_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Dataset&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9621f5a8d70d27444da0defab9faaf33a504223912c67f6b49c827a3537aa681.svg" src="../_images/9621f5a8d70d27444da0defab9faaf33a504223912c67f6b49c827a3537aa681.svg" />
</div>
</div>
<div align="justify">
<p>We will use this representation later to compare the results of the different uncertainty measures to.</p>
</div></section>
<section id="hartley-measure">
<h3><span class="section-number">13.2.2. </span>Hartley Measure<a class="headerlink" href="#hartley-measure" title="Link to this heading">#</a></h3>
<div align="justify">
<p>The standard uncertainty measure in classical possibility theory (where uncertain information is simply represented in the form of subsets <span class="math notranslate nohighlight">\(A \subseteq \mathcal{Y}\)</span> of possible alternatives) is the Hartley measure <a class="footnote-reference brackets" href="#beaware" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> (<span id="id10">Hartley [<a class="reference internal" href="../references.html#id40" title="R.V.L. Hartley. Transmission of information. Bell Syst. Tech. Journal, 7(3):535–563, 1928.">Har28</a>]</span>)</p>
<div class="math notranslate nohighlight" id="equation-hartley">
<span class="eqno">(13.2)<a class="headerlink" href="#equation-hartley" title="Link to this equation">#</a></span>\[
\begin{equation}\label{eq:hartley}
H(A) = \log( |A|)  \, ,
\end{equation}
\]</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hartley_measure</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>

<span class="n">set_sizes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">hartley_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">hartley_measure</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">set_sizes</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">set_sizes</span><span class="p">,</span> <span class="n">hartley_values</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Hartley Measure - uncertainty increases with set size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Set Size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hartley Measure&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/759f294cff74beb78adfbe27ee3cb54a6b01e882b874eeab273e44fafbf9e530.svg" src="../_images/759f294cff74beb78adfbe27ee3cb54a6b01e882b874eeab273e44fafbf9e530.svg" />
</div>
</div>
<div align="justify">
<p>Just like the Shannon entropy (cf. <a class="reference internal" href="../chapter-modelingAproxUncertainty/modelingAproxUncertainty.html"><span class="doc">Modelling Approximation Uncertainty</span></a>), this measure can be justified axiomatically<a class="footnote-reference brackets" href="#hartleymeasureaxiom" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p>Given the insight that conflict and non-specificity are two different, complementary sources of uncertainty, and standard (Shannon) entropy and (<a class="reference internal" href="#equation-hartley">(13.2)</a>) as well-established measures of these two types of uncertainty, a natural question in the context of credal sets is to ask for a generalized representation</p>
<div class="math notranslate nohighlight" id="equation-aggregate">
<span class="eqno">(13.3)<a class="headerlink" href="#equation-aggregate" title="Link to this equation">#</a></span>\[
\begin{equation}
\text{U}(Q) = \text{AU}(Q) + \text{EU}(Q) \, ,
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\text{U}\)</span> is a measure of total (aggregate) uncertainty, <span class="math notranslate nohighlight">\(\text{AU}\)</span> a measure of aleatoric uncertainty (conflict, a generalization of the Shannon entropy), and <span class="math notranslate nohighlight">\(\text{EU}\)</span> a measure of epistemic uncertainty (non-specificity, a generalization of the Hartely measure).</p>
</div>
</section>
<section id="generalized-hartley-measure">
<h3><span class="section-number">13.2.3. </span>Generalized Hartley Measure<a class="headerlink" href="#generalized-hartley-measure" title="Link to this heading">#</a></h3>
<div align="justify">
<p>As for the non-specificity part in (<a class="reference internal" href="#equation-aggregate">(13.3)</a>), the following generalization of the Hartley measure to the case of graded possibilities has been proposed by various authors <span id="id12">Abellan and Moral [<a class="reference internal" href="../references.html#id44" title="J. Abellan and S. Moral. A non-specificity measure for convex sets of probability distributions. International Journal of Uncertainty, Fuzziness and Knowledge-Based Systems, 8:357–367, 2000.">AM00</a>]</span>:</p>
<div class="math notranslate nohighlight" id="equation-gh">
<span class="eqno">(13.4)<a class="headerlink" href="#equation-gh" title="Link to this equation">#</a></span>\[
\begin{equation}
GH(Q) := \sum_{A \subseteq \mathcal{Y}} \text{m}_Q(A) \, \log(|A|) \,,
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathrm{m}_Q: \,  2^{\mathcal{Y}} \longrightarrow [0,1]\)</span> is the Möbius inverse of the capacity function <span class="math notranslate nohighlight">\(\nu :\, 2^{\mathcal{Y}} \longrightarrow [0,1]\)</span> defined by</p>
<div class="math notranslate nohighlight" id="equation-cap">
<span class="eqno">(13.5)<a class="headerlink" href="#equation-cap" title="Link to this equation">#</a></span>\[
\begin{equation}
\nu_Q(A) := \inf_{q \in Q} q(A) 
\end{equation}
\]</div>
<p>for all <span class="math notranslate nohighlight">\(A \subseteq \mathcal{Y}\)</span>, that is,</p>
<div class="math notranslate nohighlight">
\[
\text{m}_Q(A) = \sum_{B \subseteq A} (-1)^{|A \setminus B|} \nu_Q(B) \, .
\]</div>
</div>
<p>The measure (<a class="reference internal" href="#equation-gh">(13.4)</a>) enjoys several desirable axiomatic properties, and its uniqueness was shown by <span id="id13">Klir and Mariano [<a class="reference internal" href="../references.html#id41" title="G.J. Klir and M. Mariano. On the uniqueness of possibilistic measure of uncertainty and information. Fuzzy Sets and Systems, 24(2):197–219, 1987.">KM87</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_powerset</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1"># helper function to get powerset of a set</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">powerset</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span> <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))}</span>
    <span class="k">return</span> <span class="n">powerset</span>

<span class="k">def</span> <span class="nf">vq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">):</span>
    <span class="c1"># helper to compute the measure vq</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">vq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,:,</span><span class="n">idx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vq</span>
    
<span class="k">def</span> <span class="nf">mq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">):</span>
    <span class="c1"># computes the mq measure as moebius inverse of vq</span>
    
    <span class="n">powerset</span> <span class="o">=</span> <span class="n">get_powerset</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    
    <span class="n">mq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">))</span><span class="o">*</span><span class="n">vq</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">))</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">powerset</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mq</span>
    
<span class="k">def</span> <span class="nf">get_gh_measure</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    <span class="c1"># computes generalized Hartley measure</span>
    
    <span class="c1"># add axis if single set</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        
    <span class="c1"># compute powerset over classes</span>
    <span class="n">n_classes</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">powerset</span> <span class="o">=</span> <span class="n">get_powerset</span><span class="p">({</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">)})</span>
    
    <span class="c1"># compute GH measure</span>
    <span class="n">GH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">)</span><span class="o">*</span><span class="n">hartley_measure</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> 
                 <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">powerset</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">GH</span>
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>Now we compute a first uncertainty measure on our posterior credal sets by computing the generalized hartley measure on them. We can get a feeling for it by inspecting the credal sets for which the measure is the lowest and the highest:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gh</span> <span class="o">=</span> <span class="n">get_gh_measure</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
<span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">gh</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.043, 0.619, 0.338],
       [0.044, 0.   , 0.956],
       [0.811, 0.   , 0.189]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">gh</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.   , 1.   , 0.   ],
       [0.003, 0.996, 0.001],
       [0.   , 1.   , 0.   ]])
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>Now we can visualize the generalized hartley measure by creating a heatmap in the color at a point corresponds to the uncertainty of the credal set for the prediction at that point.
Comparing the result with the visualizations we created before shows the measure tends to be high for the credal sets for which we also have more different predictions:</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_uncertainty_heatmap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">measure</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
	<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
	<span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
	<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span><span class="n">y_grid</span><span class="p">)</span>
    
	<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
    
	<span class="n">mesh_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">:</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
		<span class="n">mesh_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

	<span class="n">mesh_credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_probabilities</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
	<span class="n">measure_res</span> <span class="o">=</span> <span class="n">measure</span><span class="p">(</span><span class="n">mesh_credal_sets</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    
	<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
	<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
	<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
	<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
	<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

	<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;n different predictions&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty measure heatmap&#39;</span><span class="p">]</span>
    
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]):</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

	<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
	
	<span class="n">plot_differnces_in_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>

	<span class="n">contour</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">measure_res</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

	<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>

	<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Generalized Hartley Measure&#39;</span>
<span class="n">plot_uncertainty_heatmap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">get_gh_measure</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;turbo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cbd7c0064f57960592c4176cee111ab67165877146ad7ea985870d613ecc81ec.svg" src="../_images/cbd7c0064f57960592c4176cee111ab67165877146ad7ea985870d613ecc81ec.svg" />
</div>
</div>
<div align="justify">
<p>For a different illustration we also compute the uncertainty measures on the posterior credal set of the wine data that we obtained earlier and visualize the credal sets with the highest and lowest uncertainty:</p>
</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">,</span> <span class="n">measure_res</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
	<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;ternary&#39;</span><span class="p">})</span>

	<span class="n">ridx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">measure_res</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">measure_res</span><span class="p">)]</span>
	<span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">measure_res</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">measure_res</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>

		<span class="n">credal_set</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">ridx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
		<span class="n">point</span> <span class="o">=</span> <span class="n">point_predictions</span><span class="p">[</span><span class="n">ridx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        
		<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">credal_set</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">credal_set</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">credal_set</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="c1">#ax.scatter(*credal_set[:,:], marker=&#39;.&#39;, s=10, alpha=0.5, color=&#39;blue&#39;)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Credal sets for minimal and maximal </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> measure.&quot;&quot;&quot;</span><span class="p">,</span> 
                           <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_hartley_measure</span> <span class="o">=</span> <span class="n">get_gh_measure</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>

<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Generalized Hartley Measure&#39;</span>
<span class="n">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">wine_hartley_measure</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/46a8b6226fa667173f202c4548596a7a82f2fdd98cc74290faf967fa58b5a816.svg" src="../_images/46a8b6226fa667173f202c4548596a7a82f2fdd98cc74290faf967fa58b5a816.svg" />
</div>
</div>
</section>
<section id="upper-and-lower-shannon-entropy">
<h3><span class="section-number">13.2.4. </span>Upper and Lower Shannon entropy<a class="headerlink" href="#upper-and-lower-shannon-entropy" title="Link to this heading">#</a></h3>
<div align="justify">
<p>The generalization of the Shannon entropy <span class="math notranslate nohighlight">\(H\)</span> as a measure of conflict turned out to be more difficult. The upper and lower Shannon entropy play an important role in this regard:</p>
<div class="math notranslate nohighlight">
\[
H^*(Q) := \max_{q \in Q} H(q) \, , \quad
H_*(Q) := \min_{q \in Q} H(q)
\]</div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_shannon_entropy</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="c1"># add axis if single set</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    
    <span class="n">shannon</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">credal_sets</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">credal_sets</span><span class="o">+</span><span class="mf">1e-50</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">shannon</span>

<span class="k">def</span> <span class="nf">get_upper_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="c1"># add axis if single set</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    
    <span class="n">shannon</span> <span class="o">=</span> <span class="n">get_shannon_entropy</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    
    <span class="n">upper_shannon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shannon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">upper_shannon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper_shannon</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">upper_shannon</span>

<span class="k">def</span> <span class="nf">get_lower_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="c1"># add axis if single set</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    
    <span class="n">shannon</span> <span class="o">=</span> <span class="n">get_shannon_entropy</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    
    <span class="n">lower_shannon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shannon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">lower_shannon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lower_shannon</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">lower_shannon</span>
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>With this we can compute the upper and lower shannon entropy on our credal sets. Again we look at the credal sets that show the lowest and highest uncertainty and visualize the measure:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">upper_shannon</span> <span class="o">=</span> <span class="n">get_upper_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Credal set with maximal Upper Shannon entropy:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">upper_shannon</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Credal set with minimal Upper Shannon entropy:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">upper_shannon</span><span class="p">)]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Credal set with maximal Upper Shannon entropy:
[[0.41  0.317 0.273]
 [0.265 0.281 0.454]
 [0.056 0.076 0.869]]

Credal set with minimal Upper Shannon entropy:
[[0.    1.    0.   ]
 [0.003 0.996 0.001]
 [0.    1.    0.   ]]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>We visualize the Upper Shannon entropy in the same way as before. We can see that it is still highest in the areas, where the classifiers disagree the most. However, it seems to capture more uncertainty also in other areas.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Upper Shannon entropy &#39;</span>
<span class="n">plot_uncertainty_heatmap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">get_upper_shannon</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;turbo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e8548b59b044186033aca7983e74450f476f710d87706b909d327edc74188bbe.svg" src="../_images/e8548b59b044186033aca7983e74450f476f710d87706b909d327edc74188bbe.svg" />
</div>
</div>
<p>Again we also look at the wine credal sets with the highest and lowest uncertainty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_upper_shannon</span> <span class="o">=</span> <span class="n">get_upper_shannon</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>

<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Upper shannon entropy&#39;</span>
<span class="n">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">wine_upper_shannon</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8d7f7cadd433c77c6ba50bffd7e8330800a0c34cc16296a0f7ef4bca7e9b27bf.svg" src="../_images/8d7f7cadd433c77c6ba50bffd7e8330800a0c34cc16296a0f7ef4bca7e9b27bf.svg" />
</div>
</div>
<p>We do the same for the Lower Shannon Entropy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower_shannon</span> <span class="o">=</span> <span class="n">get_lower_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Credal set with maximal Lower Shannon entropy:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">lower_shannon</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Credal set with minimal Lower Shannon entropy:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">lower_shannon</span><span class="p">)]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Credal set with maximal Lower Shannon entropy:
[[0.652 0.263 0.085]
 [0.397 0.429 0.174]
 [0.293 0.278 0.429]]

Credal set with minimal Lower Shannon entropy:
[[0.    1.    0.   ]
 [0.003 0.996 0.001]
 [0.    1.    0.   ]]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>Again we use the same visualization. We can see that the Lower Shannon entropy captures much less uncertainty than the other two. It is even zero in some areas where the classifiers disagree.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Upper Shannon entropy &#39;</span>
<span class="n">plot_uncertainty_heatmap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">get_lower_shannon</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;turbo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9c35f2a18778d3c318facf4aa82fa6a18903097eadde076d16dddc84327d7b2e.svg" src="../_images/9c35f2a18778d3c318facf4aa82fa6a18903097eadde076d16dddc84327d7b2e.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_lower_shannon</span> <span class="o">=</span> <span class="n">get_upper_shannon</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>

<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Lower shannon entropy&#39;</span>
<span class="n">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">wine_upper_shannon</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/34cd03272a3cd15a3b078e5eeae11e158edeba9752860539e4856d27f1949f63.svg" src="../_images/34cd03272a3cd15a3b078e5eeae11e158edeba9752860539e4856d27f1949f63.svg" />
</div>
</div>
</section>
</section>
<section id="uncertainty-decomposition">
<h2><span class="section-number">13.3. </span>Uncertainty Decomposition<a class="headerlink" href="#uncertainty-decomposition" title="Link to this heading">#</a></h2>
<div align="justify">
<p>Based on these measures, the following disaggregations of total uncertainty <a class="reference internal" href="#equation-aggregate">(13.3)</a> have been proposed <span id="id14">Abellan <em>et al.</em> [<a class="reference internal" href="../references.html#id45" title="J. Abellan, J. Klir, and S. Moral. Disaggregated total uncertainty measure for credal sets. International Journal of General Systems, 2006.">AKM06</a>]</span>:
a</p>
<div class="amsmath math notranslate nohighlight" id="equation-5978ffe4-5e57-431a-8303-0509f6053558">
<span class="eqno">(13.6)<a class="headerlink" href="#equation-5978ffe4-5e57-431a-8303-0509f6053558" title="Permalink to this equation">#</a></span>\[\begin{align}
H^*(Q) = \big(H^*(Q) - \text{GH}(Q) \big)  + \text{GH}(Q)
\end{align}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-bae13d4d-f3fe-45bf-ad17-06b717d738bb">
<span class="eqno">(13.7)<a class="headerlink" href="#equation-bae13d4d-f3fe-45bf-ad17-06b717d738bb" title="Permalink to this equation">#</a></span>\[\begin{align}
H^*(Q) = H_*(Q)  + \big(H^*(Q) - H_*(Q) \big)
\end{align}\]</div>
<p>In both cases, upper entropy serves as a measure of total uncertainty <span class="math notranslate nohighlight">\(U(Q)\)</span>, which is again justified on an axiomatic basis. In the first case, the generalized Hartley measure is used for quantifying epistemic uncertainty, and aleatoric uncertainty is obtained as the difference between total and epistemic uncertainty. In the second case, epistemic uncertainty is specified in terms of the difference between upper and lower entropy.</p>
</div><p>We can realize both uncertainty decompositions by combining our previous results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decomposition_1</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="n">gh</span> <span class="o">=</span> <span class="n">get_gh_measure</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    <span class="n">us</span> <span class="o">=</span> <span class="n">get_upper_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    
    <span class="n">aleatoric</span> <span class="o">=</span> <span class="n">us</span> <span class="o">-</span> <span class="n">gh</span>
    <span class="n">epistemic</span> <span class="o">=</span> <span class="n">gh</span>
    
    <span class="k">return</span> <span class="n">aleatoric</span><span class="p">,</span> <span class="n">epistemic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decomposition_2</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="n">ls</span> <span class="o">=</span> <span class="n">get_lower_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    <span class="n">us</span> <span class="o">=</span> <span class="n">get_upper_shannon</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    
    <span class="n">aleatoric</span> <span class="o">=</span> <span class="n">ls</span>
    <span class="n">epistemic</span> <span class="o">=</span> <span class="n">us</span> <span class="o">-</span> <span class="n">ls</span>
    
    <span class="k">return</span> <span class="n">aleatoric</span><span class="p">,</span> <span class="n">epistemic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aleatoric1</span><span class="p">,</span> <span class="n">epistemic1</span> <span class="o">=</span> <span class="n">decomposition_1</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>

<span class="n">aleatoric2</span><span class="p">,</span> <span class="n">epistemic2</span> <span class="o">=</span> <span class="n">decomposition_2</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>We can look at the credal sets of the queries with maximal epistemic and maximal aleatoric uncertainty. In case of the high epistemic uncertainty, we can see that the entropy of the individual distributions is not very high and it wouldnt be a problem to make a prediction based on only one of them, however the uncertainty comes from their strong disagreement:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># epistemic uncertainty estimate decomposition 1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max epistemic uncertainty. Decomposition 1:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">epistemic1</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># epistemic uncertainty estimate decomposition 2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max epistemic uncertainty. Decomposition 2:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">aleatoric2</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max epistemic uncertainty. Decomposition 1:
[[0.043 0.619 0.338]
 [0.044 0.    0.956]
 [0.811 0.    0.189]]

Max epistemic uncertainty. Decomposition 2:
[[0.652 0.263 0.085]
 [0.397 0.429 0.174]
 [0.293 0.278 0.429]]
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>When looking at the credal sets with the highest aleatoric uncertainty we can see that the entropy within the single distributions is very high which means it also might be difficult to make a prediction in that area if we could reduce the epistemic uncertainty:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aleatoric uncertainty estimate decomposition 1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max aleatoric uncertainty. Decomposition 1:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">aleatoric1</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1">#aleatoric uncertainty estimate decomposition 2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max aleatoric uncertainty. Decomposition 2:</span><span class="se">\n</span><span class="si">{</span><span class="n">credal_sets</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">aleatoric2</span><span class="p">)]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max aleatoric uncertainty. Decomposition 1:
[[0.325 0.66  0.014]
 [0.284 0.594 0.122]
 [0.185 0.732 0.082]]

Max aleatoric uncertainty. Decomposition 2:
[[0.652 0.263 0.085]
 [0.397 0.429 0.174]
 [0.293 0.278 0.429]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aleatoric1_w</span><span class="p">,</span> <span class="n">epistemic1_w</span> <span class="o">=</span> <span class="n">decomposition_2</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can again visualize the credal sets with minimal and maximal uncertainty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">aleatoric1_w</span><span class="p">,</span> <span class="s1">&#39;Aleatoric uncertainty decomposition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8e3921640c701311ca29a6a0c9bfe9acf951fc057c2a50bae2a625b1df6e9df8.svg" src="../_images/8e3921640c701311ca29a6a0c9bfe9acf951fc057c2a50bae2a625b1df6e9df8.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_uncertainty_triangle</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">epistemic1_w</span><span class="p">,</span> <span class="s1">&#39;Epistemic uncertainty decomposition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/65b7e8ae2e63951298d5ebf12624df2f54ef68586f909d746640dfb10fe5cdcb.svg" src="../_images/65b7e8ae2e63951298d5ebf12624df2f54ef68586f909d746640dfb10fe5cdcb.svg" />
</div>
</div>
</section>
<section id="set-valued-prediction">
<span id="set-predictions"></span><h2><span class="section-number">13.4. </span>Set-valued prediction<a class="headerlink" href="#set-valued-prediction" title="Link to this heading">#</a></h2>
<div align="justify">
<p>Credal classifiers are used for “indeterminate” prediction, that is, to produce reliable set-valued predictions that are likely to cover the true outcome. In this regard, the notion of <em>dominance</em> plays an important role: An outcome <span class="math notranslate nohighlight">\(y\)</span> dominates another outcome <span class="math notranslate nohighlight">\(y'\)</span> if <span class="math notranslate nohighlight">\(y\)</span> is more probable than <span class="math notranslate nohighlight">\(y'\)</span> for each distribution in the credal set, that is,</p>
<div class="amsmath math notranslate nohighlight" id="equation-50434905-7d49-4372-a302-466ddf3a36d1">
<span class="eqno">(13.8)<a class="headerlink" href="#equation-50434905-7d49-4372-a302-466ddf3a36d1" title="Permalink to this equation">#</a></span>\[\begin{align}
\gamma(y,y', \vec{x}) :=
\inf_{h \in C} \frac{p( y | \vec{x}_q, h)}{p(y' | \vec{x}_q, h)}  &gt; 1 \, ,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is a credal set of hypotheses, and <span class="math notranslate nohighlight">\(p( y | \vec{x}, h)\)</span> the probability of the outcome <span class="math notranslate nohighlight">\(y\)</span> (for the query <span class="math notranslate nohighlight">\(\vec{x}_q\)</span>) under hypothesis <span class="math notranslate nohighlight">\(h\)</span>.</p>
</div><p>First we define a function to capture the notion of dominance within a credal set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_dominated</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yprime</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="n">dominated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,:,</span><span class="n">y</span><span class="p">]</span> <span class="o">&gt;</span> 
                       <span class="n">credal_sets</span><span class="p">[:,:,</span><span class="n">yprime</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dominated</span>
</pre></div>
</div>
</div>
</div>
<p>In the following credal set class 1 is dominated by class 0, as class probabilities are higher across all distributions in the set. However it is not dominated by class 2 since the class probability for 2 in the first distribution isnt higher:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.719</span><span class="p">,</span> <span class="mf">0.279</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">],</span>
			  <span class="p">[</span><span class="mf">0.823</span><span class="p">,</span> <span class="mf">0.027</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>
			  <span class="p">[</span><span class="mf">0.643</span><span class="p">,</span> <span class="mf">0.122</span><span class="p">,</span> <span class="mf">0.235</span><span class="p">]])</span>

<span class="n">is_dominated</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">yprime</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">credal_sets</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ True, False]])
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>The set-valued prediction for a query <span class="math notranslate nohighlight">\(\vec{x}_q\)</span> is then given by the set of all non-dominated outcomes <span class="math notranslate nohighlight">\(y \in \set{Y}\)</span>, i.e., those outcomes that are not dominated by any other outcome.
Practically, the computations are based on the interval-valued probabilities
<span class="math notranslate nohighlight">\([\underline{p}(y | \vec{x}_q), \overline{p}(y || \vec{x}_q)]\)</span>
assigned to each class <span class="math notranslate nohighlight">\(y \in \set{Y}\)</span>, where</p>
<div class="amsmath math notranslate nohighlight" id="equation-8c6e308b-444d-4d94-94b0-79116e5d70f5">
<span class="eqno">(13.9)<a class="headerlink" href="#equation-8c6e308b-444d-4d94-94b0-79116e5d70f5" title="Permalink to this equation">#</a></span>\[\begin{align}
\underline{p}(y | \vec{x}_q) := \inf_{h \in C} p(y | \vec{x}_q, h)\, , \quad \overline{p}(y | \vec{x}_q) := \sup_{h \in C} p(y | \vec{x}_q, h) \, .
\end{align}\]</div>
<p>Note that the upper probabilities <span class="math notranslate nohighlight">\(\overline{p}(y | \vec{x}_q)\)</span> are very much in the spirit of the plausibility degrees (\ref{eq:plaus}) (equation in chapter 4.7 not there yet).</p>
</div><p>We define another function to determine which classes are not dominated across all our credal sets. With this we can then do set valued prediction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_not_dominated</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="n">n_samples</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">n_classes</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Create a matrix to hold the dominance results</span>
    <span class="n">dominance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">yprime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_classes</span><span class="p">)</span> <span class="o">!=</span> <span class="n">yprime</span>
        
        <span class="c1"># for each sample check if class is dominated by any other</span>
        <span class="n">is_dominated_by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_dominated</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yprime</span><span class="p">,</span> <span class="n">credal_sets</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># class is not dominated if is_dominated is false</span>
        <span class="n">dominance</span><span class="p">[:,</span> <span class="n">yprime</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">is_dominated_by</span>
    
    <span class="k">return</span> <span class="n">dominance</span>

<span class="k">def</span> <span class="nf">get_set_predictions</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">n_classes</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="n">not_dominated</span> <span class="o">=</span> <span class="n">get_not_dominated</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_classes</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">not_dominated</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">set_predictions</span> <span class="o">=</span> <span class="n">get_set_predictions</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">)</span>
<span class="n">set_predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([0]),
 array([0, 2]),
 array([1]),
 array([0, 2]),
 array([2]),
 array([0]),
 array([0]),
 array([1, 2]),
 array([0, 1, 2]),
 array([0])]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_cardinality_old</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>

	<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
	<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

	<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
	<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

	<span class="n">mesh_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">:</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
		<span class="n">mesh_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

	<span class="n">mesh_credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_probabilities</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    
	<span class="n">set_predictions</span> <span class="o">=</span> <span class="n">get_set_predictions</span><span class="p">(</span><span class="n">mesh_credal_sets</span><span class="p">)</span>
	<span class="n">cardinalities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">set_predictions</span><span class="p">])</span>
	<span class="n">cardinalities</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>

	<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;N different predictions&#39;</span><span class="p">,</span> <span class="s1">&#39;Cardinality prediction set&#39;</span><span class="p">]</span>

	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	
	<span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">axes</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

	<span class="n">plot_differnces_in_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
	
	<span class="c1"># Define a custom colormap</span>
	<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
	<span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

	<span class="c1"># Create a legend</span>
	<span class="n">legend_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
    <span class="p">}</span>
    
	<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
	
	<span class="n">contour</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cardinalities</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cardinality of prediction set&#39;</span><span class="p">)</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
	
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
 
<span class="k">def</span> <span class="nf">plot_cardinality</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
	<span class="n">number_of_classes</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># parameter used for the colors</span>

	<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    
	<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

	<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
	<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

	<span class="n">mesh_probabilities</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">:</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
		<span class="n">mesh_probabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

	<span class="n">mesh_credal_sets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh_probabilities</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    
	<span class="n">set_predictions</span> <span class="o">=</span> <span class="n">get_set_predictions</span><span class="p">(</span><span class="n">mesh_credal_sets</span><span class="p">)</span>
	<span class="n">cardinalities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">set_predictions</span><span class="p">])</span>
	<span class="n">cardinalities</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>

	<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;N different predictions&#39;</span><span class="p">,</span> <span class="s1">&#39;Cardinality prediction set&#39;</span><span class="p">]</span>

	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	
	<span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">axes</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">cardinalities</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

	<span class="n">plot_differnces_in_boundary</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
	 
    <span class="c1"># Build the Discrete Color Map</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s2">&quot;tab10&quot;</span><span class="p">]</span> <span class="c1"># define the colormap. As 3 colors are already used for the plot_differnces_in_boundary we use the next 3 colors</span>

 
    <span class="c1"># extract all colors from cmap</span>
	<span class="n">cmaplist</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span> <span class="c1"># take the next 3 unused colors from the cmap. The first 3 are used n plot_differnces_in_boundary</span>
 
    <span class="c1"># create the new map</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s1">&#39;Custom cmap&#39;</span><span class="p">,</span> <span class="n">cmaplist</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmaplist</span><span class="p">))</span> 
    
    <span class="c1"># define the bins and normalize</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">)</span>

	<span class="c1"># Create a legend</span>
	<span class="n">legend_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
    <span class="p">}</span>
    
	<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
	
	<span class="n">contour</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cardinalities</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
 
 
 
	<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cardinality of prediction set&#39;</span><span class="p">)</span>
	<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
	
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div align="justify">
<p>We now visualize the cardinality of the prediction set next to the dataset and the number of predictions:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cardinality</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 100)
</pre></div>
</div>
<img alt="../_images/7d8800057409fa2639166468033ddce6b8ca9cb132713060d7771486ea952a93.svg" src="../_images/7d8800057409fa2639166468033ddce6b8ca9cb132713060d7771486ea952a93.svg" />
</div>
</div>
<div align="justify">
<p>Now we can also create a set prediction for the wine credal set we obtained at the beginning. We visualize three credal sets for which we received different sized set predictions, in the same way as before:</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_set_predictions</span> <span class="o">=</span> <span class="n">get_set_predictions</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>
<span class="n">wine_set_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([0, 2]),
 array([0, 2]),
 array([2]),
 array([0]),
 array([1]),
 array([0]),
 array([1, 2]),
 array([2]),
 array([1]),
 array([2])]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wine_set_predictions</span><span class="p">])</span><span class="o">==</span><span class="n">i</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Three random credal sets with different sized set predictions&quot;</span>
<span class="n">axtitles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cardinality 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cardinality 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cardinality 3&#39;</span><span class="p">]</span>
<span class="n">create_posterior_plot</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">point_predictions</span><span class="p">,</span> <span class="n">ridx</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">axtitles</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d93dfa74166be10ebd7298ea72eb963df992c1b111e1852b33e818f585978923.svg" src="../_images/d93dfa74166be10ebd7298ea72eb963df992c1b111e1852b33e818f585978923.svg" />
</div>
</div>
<section id="dominance-degrees">
<h3><span class="section-number">13.4.1. </span>Dominance degrees<a class="headerlink" href="#dominance-degrees" title="Link to this heading">#</a></h3>
<div align="justify">
<p>Interestingly, uncertainty degrees can be derived on the basis of dominance degrees (\ref{eq:dominance}). For example, the following uncertainty score has been proposed by <span id="id15">Antonucci <em>et al.</em> [<a class="reference internal" href="../references.html#id2266" title="Alessandro Antonucci, Giorgio Corani, and Sandra Gabaglio. Active learning by the naive credal classifier. In Proceedings of the Sixth European Workshop on Probabilistic Graphical Models (PGM), 3–10. 2012.">ACG12</a>]</span> in the context of uncertainty sampling for active learning:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ddfc6764-335d-4dba-b5dd-e5dd65523cd7">
<span class="eqno">(13.10)<a class="headerlink" href="#equation-ddfc6764-335d-4dba-b5dd-e5dd65523cd7" title="Permalink to this equation">#</a></span>\[\begin{align}
s(\vec{x}_q) := - \max \big(\gamma(+1, -1, \vec{x}_q ), \gamma(-1, +1, \vec{x}_q ) \big) \, .
\end{align}\]</div>
<p>For data sets with more than two classes the score generalizes as follows:</p>
<div class="amsmath math notranslate nohighlight" id="equation-315c93be-a1ae-41aa-9201-be856606aa77">
<span class="eqno">(13.11)<a class="headerlink" href="#equation-315c93be-a1ae-41aa-9201-be856606aa77" title="Permalink to this equation">#</a></span>\[\begin{align}
s(\vec{x}_q) := - \sum_{c' \in \mathcal{C}} \sum_{c'' \in \mathcal{C} \setminus \{c'\}} \max[\gamma(c', c''), \gamma(c'', c')]
\end{align}\]</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_dominance_degrees</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">):</span>
    <span class="c1"># Computes dominance degrees on credal sets </span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">n_classes</span> <span class="o">=</span> <span class="n">credal_sets</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Create a matrix to hold the dominance results</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">yprime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_classes</span><span class="p">)</span> <span class="o">!=</span> <span class="n">yprime</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">yprime</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span><span class="mf">1e-8</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">y</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">credal_sets</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">yprime</span><span class="p">][:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span><span class="mf">1e-8</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        

        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        
    <span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">scores</span>
</pre></div>
</div>
</div>
</div>
<p>With this we compute the dominance degrees on our wine credal sets:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dominance_degrees</span> <span class="o">=</span> <span class="n">get_dominance_degrees</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dominance_degrees</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-21.019783333333336
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dominance_degrees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -8.5397,  -6.287 ,  -5.0387,  -8.8752,  -8.0609,  -8.8752,
       -17.4435, -10.9688,  -6.8588, -10.9688,  -1.9801,  -6.7124,
       -10.9688,  -0.9523,  -8.8752, -10.9688, -18.1132, -19.3644,
       -91.9595, -18.1132, -91.9595, -18.083 , -24.9303,  -7.8137,
        -3.6982,  -6.287 ,  -3.6982,  -3.6982, -18.1132,  -3.6982,
       -91.9595,  -1.4145, -10.9688,  -6.5464, -91.9595, -91.9595])
</pre></div>
</div>
</div>
</div>
<div align="justify">
<p>This degree is low if one of the outcomes strongly dominates the other one, but high if this is not the case. It is closely related to the degree of epistemic uncertainty in (\ref{eq:ep}) to be discussed in Section \ref{sec:uqnl}, but also seems to capture some aleatoric uncertainty. In fact, <span class="math notranslate nohighlight">\(s(\vec{x}_q)\)</span> increases with both, the width of the interval <span class="math notranslate nohighlight">\([\underline{p}(y | \vec{x}_q) , \overline{p}(y | \vec{x}_q)]\)</span> as well as the closeness of its middle point to <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>.</p>
</div><p>We can illustrate this by visualising credal sets with different dominance degrees in the barycentric coordinate system:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_idx</span><span class="p">,</span> <span class="n">max_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dominance_degrees</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dominance_degrees</span><span class="p">)</span>
<span class="n">med_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dominance_degrees</span><span class="p">)</span> <span class="o">==</span> <span class="n">dominance_degrees</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_idx</span><span class="p">,</span> <span class="n">med_idx</span><span class="p">,</span> <span class="n">max_idx</span><span class="p">]</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Credal sets with different dominance degrees. Degree increases with interval width and closeness to middle point.&quot;</span>
<span class="n">axtitles</span> <span class="o">=</span> <span class="p">[</span><span class="n">dominance_degrees</span><span class="p">[</span><span class="n">min_idx</span><span class="p">],</span> <span class="n">dominance_degrees</span><span class="p">[</span><span class="n">med_idx</span><span class="p">],</span> <span class="n">dominance_degrees</span><span class="p">[</span><span class="n">max_idx</span><span class="p">]]</span>
<span class="n">create_posterior_plot</span><span class="p">(</span><span class="n">wine_credal_sets</span><span class="p">,</span> <span class="n">point_predictions</span><span class="p">,</span> <span class="n">ridx</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">axtitles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c48a7881835d0961f2e38196a1b616d73d2a02702849f903fefdab4d0b258d22.svg" src="../_images/c48a7881835d0961f2e38196a1b616d73d2a02702849f903fefdab4d0b258d22.svg" />
</div>
</div>
<div align="justify">
<p><span id="id16">Lassiter [<a class="reference internal" href="../references.html#id8" title="D. Lassiter. Representing credal imprecision: from sets of measures to hierarchical Bayesian models. Philosophical Studies, 2020. forthcoming.">Las20</a>]</span> discusses the modeling of <em>credal imprecision</em> by means of sets of measures in a critical way and contrasts this approach with hierarchical probabilistic (Bayesian) models, i.e., distributions of measures. Among several arguments put forward against sets-of-measures models, one aspect is specifically interesting from a machine learning perspective, namely the problem that modeling a lack of knowledge in a set-based manner may hamper the possibility of inductive inference, up to a point where learning from empirical data is not possible any more. This is closely connected to the insight that learning from data necessarily requires an inductive bias, and learning without assumptions is not possible <span id="id17">Wolpert [<a class="reference internal" href="../references.html#id12" title="D.H. Wolpert. The lack of a priori distinctions between learning algorithms. Neural Computation, 8(7):1341–1390, 1996.">Wol96</a>]</span>. To illustrate the point, consider the case of complete ignorance as an example, which could be modeled by the credal set <span class="math notranslate nohighlight">\(\mathbb{P}_{all}\)</span> that contains all probability measures (on a hypothesis space) as candidate priors. Updating this set by pointwise conditioning on observed data will essentially reproduce the same set as a credal set of posteriors. Roughly speaking, this is because <span class="math notranslate nohighlight">\(\mathbb{P}_{all}\)</span> will contain very extreme priors, which will remain extreme even after updating with a sample of finite size. In other words, no finite sample is enough to annihilate a sufficiently extreme prior belief. Replacing <span class="math notranslate nohighlight">\(\mathbb{P}_{all}\)</span> by a proper subset of measures may avoid this problem, but any such choice (implying a sharp transition between possible and excluded priors) will appear somewhat arbitrary. According to <span id="id18">Lassiter [<a class="reference internal" href="../references.html#id8" title="D. Lassiter. Representing credal imprecision: from sets of measures to hierarchical Bayesian models. Philosophical Studies, 2020. forthcoming.">Las20</a>]</span>, an appealing alternative is using a probability distribution instead of a set, like in hierarchical Bayesian modeling.</p>
</div><hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="beaware" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">1</a><span class="fn-bracket">]</span></span>
<p>Be aware that we denote both the Hartley measure and the Shannon entropy by <span class="math notranslate nohighlight">\(H\)</span>, which is common in the literature. The meaning should be clear from the context.</p>
</aside>
<aside class="footnote brackets" id="hartleymeasureaxiom" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">2</a><span class="fn-bracket">]</span></span>
<p>For example, see Chapter IX, pages 540–616, in the book by <span id="id19">Rényi [<a class="reference internal" href="../references.html#id42" title="A. Rényi. Probability Theory. North-Holland, Amsterdam, 1970.">Renyi70</a>]</span>.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter-credal_sets"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../chapter-bayesian_neuralnetwork/bayesian.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Bayesian Neural Networks</p>
      </div>
    </a>
    <a class="right-next"
       href="../chapter-reliable_classification/reliable_classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">14. </span>Reliable Classification</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-credal-classifier">13.1. Naive Credal Classifier</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imprecise-dirichlet-model">13.1.1. Imprecise Dirichlet Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-measures-for-credal-sets">13.2. Uncertainty measures for credal sets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#credal-set-for-demonstration-of-uncertainty-measures">13.2.1. Credal set for demonstration of uncertainty measures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hartley-measure">13.2.2. Hartley Measure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalized-hartley-measure">13.2.3. Generalized Hartley Measure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upper-and-lower-shannon-entropy">13.2.4. Upper and Lower Shannon entropy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-decomposition">13.3. Uncertainty Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-valued-prediction">13.4. Set-valued prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dominance-degrees">13.4.1. Dominance degrees</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <section>
    For comprehensive discussions please contact one of our team members: 
    {Evert.Buzon,Jiawen.Wang,Nico.Ploehn,S.Thies,Sven.Morlock,Zuo.Longfei}@campus.lmu.de

        <div style="margin-top: 50px;" id="disqus_thread"></div>

        <script>
            (function() { 
                var d = document, s = d.createElement('script');
                s.src = 'https://https-werywjw-github-io-toolbox-github-io.disqus.com/embed.js';  
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section> 

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>